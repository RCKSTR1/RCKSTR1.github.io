I"‹p<div class="post-content">
    <iframe allow="encrypted-media" allowtransparency="true" class="image left" frameborder="0" height="300" src="https://open.spotify.com/embed/playlist/3nUm8KgcQTIG3jqk49rLO2" width="300"></iframe>

    <h2>Introducci√≥n</h2>

    <p>Hola de nuevo, hace tiempo que no escrib√≠a, estuve ocupado trabajando en un proyecto con Angular y ASP.NET Core,
        aprend√≠
        mucho y planeo compartir algunas cosas en pr√≥ximos posts.</p>

    <p>En este post continuaremos trabajando en GLTrack, nuestra aplicaci√≥n para registrar y monitorear un registro
        personal de
        niveles de az√∫car en la sangre, esas mediciones que deben tomarse regularmente los pacientes de diabetes.</p>

    <blockquote> En el post anterior, hab√≠amos creado una aplicaci√≥n con tres componentes b√°sicos: navegaci√≥n, dashboard
        y
        registro. Eso ya hace 1 mes y medio, as√≠ que si necesitas refrescar la memoria aqu√≠ est√° el link. <i><a href="/2019/06/18/GLTrack1.html" target="_blank">"Schematics, Componentes y Ruteo con
                Angular + Material"</a></i>.
    </blockquote>


    <p>Hoy continuaremos trabajando en el componente de registro, este componente va a permitir que el usuario registre
        sus
        niveles de glucosa y que pueda revisar y eliminar registros si es necesario.</p>


    <h2>Paso 1: Dise√±ar un modelo de datos</h2>
    <p>Como primer paso debemos dise√±ar un modelo que defina los datos que vamos a guardar. Para esto necesitamos crear
        una
        clase o interfaz que contenga las propiedades que necesitamos. En el archivo models.ts crearemos la siguiente
        interfaz:
    </p>

    <pre><code>export interface MedicionGlucosa {
    Id: string;
    Timestamp: Date;
    Nivel: number;
    Comida: string;
    AntesDespues: string;
    Fecha: Date;
}</code></pre>

    <h2>Paso 2: Crear una forma de captura</h2>
    <p>Comenzaremos creando un objeto nuevo para capturar una nueva medici√≥n agregando esta l√≠nea en el componente
        registro.component.ts:
    </p>

    <pre><code>nuevoRegistro = {} as MedicionGlucosa;</code></pre>

    <p>Antes de continuar con la interfaz gr√°fica, necesitamos importar algunos m√≥dulos de material para poder usar
        componentes
        como select y datepicker de angular material. Importa y exporta los siguientes m√≥dulos en material.module.ts:
    </p>

    <pre><code>FormsModule,
MatSelectModule,
MatDatepickerModule,
MatNativeDateModule
</code></pre>

    <p>Una vez importados los m√≥dulos necesarios podemos agregar los controles para el formulario en
        registro.component.html:</p>

    <pre><code>&lt;h1&gt;Niveles de glucosa&lt;/h1&gt;

&lt;mat-card&gt;
    &lt;mat-card-title&gt;Nuevo registro&lt;/mat-card-title&gt;
    &lt;div class="row"&gt;
        &lt;mat-form-field class="row-item grow"&gt;
            &lt;input matInput placeholder="Nivel de glucosa" [(ngModel)]="nuevoRegistro.Nivel" required&gt;
        &lt;/mat-form-field&gt;
        &lt;mat-form-field class="row-item grow"&gt;
            &lt;mat-label&gt;Comida&lt;/mat-label&gt;
            &lt;mat-select [(ngModel)]="nuevoRegistro.Comida" required&gt;
                &lt;mat-option value="Desayuno"&gt;Desayuno&lt;/mat-option&gt;
                &lt;mat-option value="Comida"&gt;Comida&lt;/mat-option&gt;
                &lt;mat-option value="Cena"&gt;Cena&lt;/mat-option&gt;
            &lt;/mat-select&gt;
        &lt;/mat-form-field&gt;
        &lt;mat-form-field class="row-item grow"&gt;
            &lt;mat-label&gt;Antes o despu√©s de alimentos&lt;/mat-label&gt;
            &lt;mat-select [(ngModel)]="nuevoRegistro.AntesDespues"&gt;
                &lt;mat-option value="Antes"&gt;Antes&lt;/mat-option&gt;
                &lt;mat-option value="Despues"&gt;Despu√©s&lt;/mat-option&gt;
            &lt;/mat-select&gt;
        &lt;/mat-form-field&gt;
        &lt;mat-form-field class="row-item grow"&gt;
            &lt;input matInput type="datetime-local" placeholder="Fecha" [(ngModel)]="nuevoRegistro.Fecha"&gt;
        &lt;/mat-form-field&gt;
        &lt;button class="row-item" mat-button [disabled]="IsInvalid()" (click)="Guardar()"&gt;
            &lt;mat-icon&gt;save&lt;/mat-icon&gt; Guardar
        &lt;/button&gt;
        &lt;button class="row-item" mat-button (click)="LimpiarForma()"&gt;
            &lt;mat-icon&gt;delete&lt;/mat-icon&gt; Cancelar
        &lt;/button&gt;
    &lt;/div&gt;
&lt;/mat-card&gt;
</code></pre>

    <div class="row">
        <div class="6u 12u$(small)">
            <p>Como puedes observar, los controles como input y mat-select tienen un atributo [(ngModel)], en este
                atributo
                estamos
                especificando una variable o propiedad de un objeto con el que va a estar ligado el control. Por
                ejemplo, el
                control
                ‚ÄúNivel de glucosa‚Äù estar√° ligado a la propiedad ‚ÄúNivel‚Äù del objeto ‚ÄúnuevoRegistro‚Äù que acabamos de crear
                en
                registro.component.ts.</p>
        </div>
        <div class="6u 12u$(small)"><span class="image fit"><a href="/assets/images/blog/GLTrack2/01-Binding.png" target="_blank"><img src="/assets/images/blog/GLTrack2/01-Binding.png" alt="" /></a></span>
        </div>
    </div>

    <p>Observa que el atributo ngModel est√° envuelto en corchetes ‚Äú[]‚Äù y par√©ntesis ‚Äú()‚Äù, esto indica que la
        sincronizaci√≥n del
        valor es en dos sentidos, entrada ‚Äú[]‚Äù y salida ‚Äú()‚Äù. De esta manera, el valor del control en HTML queda
        sincronizado
        con el valor del objeto en nuestro componente.</p>

    <div class="row">
        <div class="6u 12u$(small)"><span class="image fit"><a href="/assets/images/blog/GLTrack2/02-Buttons.png" target="_blank"><img src="/assets/images/blog/GLTrack2/02-Buttons.png" alt="" /></a></span>
        </div>
        <div class="6u 12u$(small)">
            <p>Tambi√©n podemos ver que los botones del formulario tienen los atributos [disabled] y (click). Esto indica
                que solamente nos interesa escribir el valor de ‚Äú[disabled]‚Äù con el resultado de la funci√≥n
                ‚ÄúIsInvalid()‚Äù y
                que solamente estaremos escuchando el evento ‚Äú(click)‚Äù de los botones.</p>
        </div>

    </div>

    <h3>El bot√≥n ‚ÄúGuardar‚Äù</h3>

    <p>En este caso, el valor de ‚Äú[disabled]‚Äù va a depender del resultado de la funci√≥n ‚ÄúIsInvalid()‚Äù. Agrega esta
        funci√≥n en
        registro.component.ts:</p>

    <div class="row">
        <div class="6u 12u$(small)">
            <p>Esta funci√≥n regresar√° un valor booleano. Verdadero si alguna de las propiedades del nuevo registro es
                undefined
                y falso
                si todas las propiedades tienen un valor asignado. De esta manera nos aseguramos de que el usuario pueda
                guardar
                un
                registro solamente si ha llenado todos los campos del formulario.</p>
        </div>
        <div class="6u 12u$(small)">
            <pre><code>IsInvalid() {
    return this.nuevoRegistro.Nivel === undefined
        || this.nuevoRegistro.Comida === undefined
        || this.nuevoRegistro.AntesDespues === undefined
        || this.nuevoRegistro.Comida === undefined
        || this.nuevoRegistro.Fecha === undefined;
}
            </code></pre>
        </div>

    </div>

    <p>En el bot√≥n ‚ÄúGuardar‚Äù, indicamos que el evento ‚Äú(click)‚Äù va a ejecutar la funci√≥n ‚ÄúGuardar()‚Äù. Esta funci√≥n debe
        encargarse de tomar los datos capturados y enviarlos a una base de datos, un archivo o alguna manera de
        almacenamiento
        de datos. En este caso estaremos utilizando ‚ÄúlocalStorage‚Äù, un espacio de almacenamiento del navegador. Agrega
        las
        siguientes funciones en registro.component.ts:</p>

    <pre><code>Guardar() {
    this.nuevoRegistro.Id = this.NewGuid();
    const mediciones = this.GetAll();
    mediciones.push(this.nuevoRegistro);
    localStorage.setItem('registros', JSON.stringify(mediciones));
}

private NewGuid() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0,
        v = c == 'x' ? r : (r &amp; 0x3 | 0x8);
        return v.toString(16);
    });
}
</code></pre>

    <p>La funci√≥n ‚ÄúGuardar()‚Äù se est√° encargando de convertir el nuevo registro en una cadena de caracteres con formato
        JSON y
        guardarla en localStorage, mientras que utiliza la funci√≥n ‚ÄúNewGuid()‚Äù para generar un GUID que es usado como
        llave o
        identificador √∫nico para el nuevo registro.</p>

    <p>Esto podr√≠a funcionar, sin embargo, la √∫nica responsabilidad de este componente deber√≠a ser presentar datos en la
        pantalla y encargarse de las interacciones del usuario con la interfaz gr√°fica.</p>

    <p>Para solucionar esto y cumplir con el 1er principio SOLID ‚Äì Single responsibility ‚Äì necesitamos crear un servicio
        de
        angular, que se va a encargar del almacenamiento de datos √∫nicamente, sin depender de la interfaz gr√°fica, de
        validaciones ni del estado de ning√∫n componente.</p>


    <div class="row">
        <div class="6u 12u$(small)">
            <p>En la consola ejecuta el siguiente comando para crear el servicio:</p>

        </div>
        <div class="6u 12u$(small)">
            <pre><code>ng generate service services/mediciones</code></pre>
        </div>
    </div>

    <p>Esto crear√° un nuevo servicio en app/services/mediciones.service.ts.</p>

    <div class="row">
        <div class="6u 12u$(small)">
            <span class="image fit"><a href="/assets/images/blog/GLTrack2/03-StorageKey.png" target="_blank"><img src="/assets/images/blog/GLTrack2/03-StorageKey.png" alt="" /></a></span>
        </div>
        <div class="6u 12u$(small)">
            Comenzamos creando una variable que contiene el nombre de la llave que utilizaremos para acceder a los datos
            guardados
            en localStorage. De esta manera solo tenemos que modificar este valor si decidimos cambiar el nombre de
            nuestros datos
            en localStorage.
        </div>
    </div>

    <p>El servicio debe encargarse de inicializar nuestros datos en localStorage si es que no existen, por ejemplo,
        si es la
        primera vez que ejecutamos la aplicaci√≥n o si hemos borrado los datos del navegador. Para esto, debemos
        agregar esta
        validaci√≥n al constructor del servicio.</p>

    <p style="text-align:center !important;">
        <span class="image"><a href="/assets/images/blog/GLTrack2/04-ServiceConstructor.png" target="_blank"><img src="/assets/images/blog/GLTrack2/04-ServiceConstructor.png" alt="" /></a></span>
    </p>

    <p>De esta manera cuando el servicio es instanciado en la aplicaci√≥n, el constructor verifica si existen datos en el
        navegador y de no ser as√≠ inicializa con un arreglo vac√≠o.</p>

    <p>Para encargarse de la lectura y escritura de datos, vamos a agregar 3 funciones al servicio: GetAll() para
        recuperar la
        lista completa de registros, Create() para guardar un nuevo registro y Delete() para eliminar un registro en
        especial.</p>

    <p style="text-align:center !important;">
        <span class="image"><a href="/assets/images/blog/GLTrack2/05-GetAll.png" target="_blank"><img src="/assets/images/blog/GLTrack2/05-GetAll.png" alt="" /></a></span>
        <br /><i>Esta funci√≥n recupera los datos de localStorage como un string y lo convierte en un arreglo de objetos de
            tipo
            MedicionGlucosa.</i>
    </p>

    <div class="row">
        <div class="6u 12u$(small)">
            <p>Despu√©s, agregaremos la funci√≥n Create(). Esta funci√≥n recibe como par√°metro un objeto que debemos
                guardar. Para
                esto,
                el primer paso es generar una nueva llave √∫nica para identificarlo en la lista de objetos. Despu√©s,
                obtenemos la
                lista
                de objetos guardados y agregamos el nuevo registro para guardar la lista actualizada.</p>

            <p>Observa que la creaci√≥n de un GUID se encuentra en una funci√≥n separada ‚ÄúNewGuid()‚Äù esta funci√≥n tiene el
                modificador
                ‚Äúprivate‚Äù, esto quiere decir que esta funci√≥n solo es accesible dentro del servicio, a diferencia de las
                dem√°s
                funciones
                que son visibles desde otros servicios, m√≥dulos o componentes.</p>
        </div>
        <div class="6u 12u$(small)">
            <span class="image fit"><a href="/assets/images/blog/GLTrack2/06-Create.png" target="_blank"><img src="/assets/images/blog/GLTrack2/06-Create.png" alt="" /></a></span>
        </div>
    </div>

    <div class="row">
        <div class="6u 12u$(small)">
            <span class="image fit"><a href="/assets/images/blog/GLTrack2/07-Delete.png" target="_blank"><img src="/assets/images/blog/GLTrack2/07-Delete.png" alt="" /></a></span>
        </div>
        <div class="6u 12u$(small)">
            <p>Por √∫ltimo, agregaremos la funci√≥n ‚ÄúDelete()‚Äù que se encarga de eliminar registros de la lista. Esta
                funci√≥n recibe como
                par√°metro un string que debe contener el ID del objeto que ser√° eliminado.</p>
        </div>

    </div>

    <p>Despu√©s de este paso el servicio mediciones.service.ts debe contener lo siguiente:</p>

    <pre><code>import { Injectable } from '@angular/core';
import { MedicionGlucosa } from '../models/models';

@Injectable({
    providedIn: 'root'
})
export class MedicionesService {
    storageKey = 'mediciones';

    constructor() {
        if (localStorage.getItem(this.storageKey) === null) {
            localStorage.setItem(this.storageKey, JSON.stringify([] as MedicionGlucosa[]));
        }
    }

    GetAll() {
        const medicionesString = localStorage.getItem(this.storageKey);
        return JSON.parse(medicionesString) as MedicionGlucosa[];
    }

    Create(mc: MedicionGlucosa) {
        mc.Id = this.NewGuid();

        const mediciones = this.GetAll();
        mediciones.push(mc);
        localStorage.setItem(this.storageKey, JSON.stringify(mediciones));
    }

    Delete(id: string) {
        const mediciones = this.GetAll();
        const i = mediciones.findIndex(f =&gt; f.Id === id);
        if (i &gt; -1) {
            mediciones.splice(i, 1);
            localStorage.setItem(this.storageKey, JSON.stringify(mediciones));
        }
    }

    private NewGuid() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0,
            v = c == 'x' ? r : (r &amp; 0x3 | 0x8);
            return v.toString(16);
        });
    }
}
</code></pre>

    <p>Ahora podemos regresar al componente de registro y actualizarlo para dejar que el servicio se encargue de leer y
        escribir los datos.</p>

    <p>Para poder utilizar el servicio que acabamos de crear desde registro.component.ts necesitamos utilizar una
        t√©cnica
        conocida como Dependency Injection. De esta manera, no necesitamos crear una instancia del servicio, sino que
        Angular se
        encargar√° de crearla e inyectarla en todos los componentes que la necesiten. Para utilizar Dependency Injection,
        solamente agrega un par√°metro al constructor del componente en registro.component.ts:</p>

    <pre><code>import { MedicionesService } from 'src/app/services/mediciones.service';
‚Ä¶
constructor(private mediciones: MedicionesService) {
}
</code></pre>

    <p>Esto es suficiente para que una instancia del servicio ‚ÄúMedicionesService‚Äù sea accesible desde el componente.</p>
    <p>Ahora podemos actualizar la funci√≥n ‚ÄúGuardar()‚Äù en registro.component.ts para que solo se encargue de actualizar
        la interfaz gr√°fica y le
        deje el
        trabajo de escribir los datos al servicio inyectado:</p>

    <pre><code>Guardar() {
    if (!this.IsInvalid()) {
        this.mediciones.Create(this.nuevoRegistro);
        this.LimpiarForma();
        this.registros = this.mediciones.GetAll();
        this.dataSource.data = this.registros;
    }
}

LimpiarForma() {
    this.nuevoRegistro = {} as MedicionGlucosa;
}
</code></pre>

    <p>Adem√°s de actualizar la funci√≥n ‚ÄúGuardar()‚Äù hemos creado una funci√≥n ‚ÄúLimpiarForma()‚Äù que se encarga de limpiar
        los
        controles del formulario reinicializando el objeto ‚ÄúnuevoRegistro‚Äù. Recuerda que los controles del formulario
        est√°n
        ligados a este objeto utilizando la directiva ‚ÄúngModel‚Äù, por eso no es necesario manipular el HTML manualmente.
    </p>

    <p>Esta funci√≥n (‚ÄúLimpiarForma()‚Äù) tambi√©n es utilizada por el bot√≥n ‚ÄúCancelar‚Äù del formulario.</p>

    <h2>Paso 3: Crear tabla de registros</h2>

    <p>A continuaci√≥n, necesitamos crear un componente que muestre una tabla con los datos guardados por el usuario.</p>

    <p style="text-align:center !important;">
        <span class="image"><a href="/assets/images/blog/GLTrack2/08-Tabla.png" target="_blank"><img src="/assets/images/blog/GLTrack2/08-Tabla.png" alt="" /></a></span>
    </p>

    <p>Agrega el siguiente c√≥digo HTML al archivo registro.component.html:</p>

    <pre><code>&lt;mat-card&gt;
        &lt;mat-card-title&gt;Mis registros&lt;/mat-card-title&gt;
        &lt;div class="row"&gt;
            &lt;mat-form-field class="row-item grow"&gt;
                &lt;input matInput (keyup)="applyFilter($event.target.value)" placeholder="Buscar"&gt;
            &lt;/mat-form-field&gt;
        &lt;/div&gt;
        
        &lt;table mat-table [dataSource]="dataSource" matSort&gt;
            &lt;ng-container matColumnDef="fecha"&gt;
                &lt;th mat-header-cell *matHeaderCellDef mat-sort-header&gt; Fecha &lt;/th&gt;
                &lt;td mat-cell *matCellDef="let row"&gt; &#123;&#123;row.Fecha|date:'medium'}} &lt;/td&gt;
            &lt;/ng-container&gt;
            
            &lt;ng-container matColumnDef="nivel"&gt;
                &lt;th mat-header-cell *matHeaderCellDef mat-sort-header&gt; ID &lt;/th&gt;
                &lt;td mat-cell *matCellDef="let row"&gt; &#123;&#123;row.Nivel}} &lt;/td&gt;
            &lt;/ng-container&gt;
            
            &lt;ng-container matColumnDef="comida"&gt;
                &lt;th mat-header-cell *matHeaderCellDef mat-sort-header&gt; Comida &lt;/th&gt;
                &lt;td mat-cell *matCellDef="let row"&gt; &#123;&#123;row.Comida}} &lt;/td&gt;
            &lt;/ng-container&gt;
            
            &lt;ng-container matColumnDef="antesDespues"&gt;
                &lt;th mat-header-cell *matHeaderCellDef mat-sort-header&gt; Antes/Despu√©s &lt;/th&gt;
                &lt;td mat-cell *matCellDef="let row"&gt; &#123;&#123;row.AntesDespues}} &lt;/td&gt;
            &lt;/ng-container&gt;
            
            &lt;ng-container matColumnDef="actions"&gt;
                &lt;th mat-header-cell *matHeaderCellDef&gt; &lt;/th&gt;
                &lt;td mat-cell *matCellDef="let row"&gt;
                    &lt;button mat-icon-button (click)="Eliminar(row.Id)"&gt;
                        &lt;mat-icon&gt;delete&lt;/mat-icon&gt;
                    &lt;/button&gt;
                &lt;/td&gt;
            &lt;/ng-container&gt;
            
            &lt;tr mat-header-row *matHeaderRowDef="displayedColumns"&gt;&lt;/tr&gt;
            &lt;tr mat-row *matRowDef="let row; columns: displayedColumns;"&gt;&lt;/tr&gt;
        &lt;/table&gt;
        
        &lt;mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"&gt;&lt;/mat-paginator&gt;
    &lt;/mat-card&gt;
</code></pre>

    <p>Adem√°s de definir aspectos est√©ticos del componente, estamos insertando un campo de texto para filtrar los
        contenidos de
        la tabla, tambi√©n especifica las columnas disponibles y el dato que mostraremos en cada una de ellas. Por
        √∫ltimo,
        estamos insertando un paginador para ayudar al usuario a navegar entre sus registros.</p>
    <p>Ahora necesitamos conectar los datos en registro.component.ts a la tabla. Para esto comenzaremos creando una
        variable
        que guardar√° la lista de registros en el componente.</p>

    <pre><code>export class RegistroComponent implements OnInit {
    registros = [] as MedicionGlucosa[];
    nuevoRegistro = {} as MedicionGlucosa;
    ‚Ä¶
}
</code></pre>

    <p>Tambi√©n debemos agregar algunas variables para el funcionamiento de la tabla:</p>

    <pre><code>displayedColumns: string[] = ['fecha', 'nivel', 'comida', 'antesDespues', 'actions'];
dataSource: MatTableDataSource&lt;MedicionGlucosa&gt;;

@ViewChild(MatPaginator, &#123; static: true }) paginator: MatPaginator;
@ViewChild(MatSort, &#123; static: true }) sort: MatSort;
</code></pre>

    <p>La variable ‚ÄúdisplayedColumns‚Äù es un arreglo de strings que indica el nombre de las columnas y el orden en el que
        ser√°n
        mostradas en la tabla, estos valores deben coincidir con el nombre que hemos indicado en el archivo
        registro.component.html.</p>

    <p style="text-align:center !important;">
        <span class="image"><a href="/assets/images/blog/GLTrack2/09-Columnas.png" target="_blank"><img src="/assets/images/blog/GLTrack2/09-Columnas.png" alt="" /></a></span>
    </p>

    <div class="row">
        <div class="5u 12u$(small)">
            <p>Ahora tenemos una tabla lista para mostrar datos, pero necesitamos recuperar los datos existentes para
                llenar la
                tabla
                cuando se carga el componente. Para esto necesitamos utilizar el servicio mediciones.service.ts en la
                funci√≥n
                ‚ÄúngOnInit()‚Äù de nuestro componente. Agrega las siguientes l√≠neas en el archivo registro.component.ts:
            </p>

        </div>
        <div class="7u 12u$(small)">
            <pre><code>ngOnInit() {
    this.registros = this.mediciones.GetAll();
    this.dataSource = new MatTableDataSource(this.registros);
    this.dataSource.paginator = this.paginator;
    this.dataSource.sort = this.sort;
}
    </code></pre>
        </div>

    </div>

    <p>De esta manera, cuando se inicializa registro.component.ts recuperamos los datos almacenados e inicializamos la
        tabla
        para mostrar los datos.</p>

    <p>Lo √∫nico que falta en la tabla es la habilidad de eliminar un registro. Para esto utilizaremos el bot√≥n en la
        √∫ltima
        columna.</p>

    <p style="text-align:center !important;">
        <span class="image"><a href="/assets/images/blog/GLTrack2/10-Delete.png" target="_blank"><img src="/assets/images/blog/GLTrack2/10-Delete.png" alt="" /></a></span>
    </p>

    <div class="row">
        <div class="6u 12u$(small)">
            <p>Esta columna muestra un bot√≥n para eliminar registros. Con el atributo (click) estaremos ejecutando la
                funci√≥n
                ‚ÄúEliminar()‚Äù cuando el usuario dispare el evento ‚Äúclick‚Äù. Agrega la funci√≥n ‚ÄúEliminar()‚Äù en
                registro.component.ts:</p>

        </div>
        <div class="6u 12u$(small)">
            <pre><code>
Eliminar(id: string) {
    this.mediciones.Delete(id);
    this.registros = this.mediciones.GetAll();
    this.dataSource.data = this.registros;
}
        </code></pre>
        </div>

    </div>

    <p>Esta funci√≥n recibe como par√°metro el id del registro a eliminar y utiliza el servicio mediciones.service.ts para
        llevar
        a cabo la operaci√≥n. Despu√©s de eliminar el registro, vuelve a utilizar el servicio para obtener los datos
        actualizados
        y actualiza los datos de la tabla.</p>

    <p>Despu√©s de este paso, registro.component.ts queda as√≠:</p>

    <pre><code>import &#123; Component, OnInit, ViewChild } from '@angular/core';
import &#123; MatTableDataSource, MatPaginator, MatSort } from '@angular/material';
import &#123; MedicionGlucosa } from 'src/app/models/models';
import &#123; MedicionesService } from 'src/app/services/mediciones.service';

@Component(&#123;
    selector: 'app-registro',
    templateUrl: './registro.component.html',
    styleUrls: ['./registro.component.css']
})
export class RegistroComponent implements OnInit &#123;
    registros = [] as MedicionGlucosa[];
    nuevoRegistro = &#123;} as MedicionGlucosa;

    displayedColumns: string[] = ['fecha', 'nivel', 'comida', 'antesDespues', 'actions'];
    dataSource: MatTableDataSource&lt;MedicionGlucosa&gt;;

    @ViewChild(MatPaginator, &#123; static: true }) paginator: MatPaginator;
    @ViewChild(MatSort, &#123; static: true }) sort: MatSort;

    constructor(private mediciones: MedicionesService) &#123;
    }

    ngOnInit() &#123;
        this.registros = this.mediciones.GetAll();
        this.dataSource = new MatTableDataSource(this.registros);
        this.dataSource.paginator = this.paginator;
        this.dataSource.sort = this.sort;
    }

    Guardar() &#123;
        if (!this.IsInvalid()) &#123;
            this.mediciones.Create(this.nuevoRegistro);
            this.LimpiarForma();
            this.registros = this.mediciones.GetAll();
            this.dataSource.data = this.registros;
        }
    }

    Eliminar(id: string) &#123;
        this.mediciones.Delete(id);
        this.registros = this.mediciones.GetAll();
        this.dataSource.data = this.registros;
    }

    LimpiarForma() &#123;
        this.nuevoRegistro = &#123;} as MedicionGlucosa;
    }

    IsInvalid() &#123;
        return this.nuevoRegistro.Nivel === undefined
        || this.nuevoRegistro.Comida === undefined
        || this.nuevoRegistro.AntesDespues === undefined
        || this.nuevoRegistro.Comida === undefined
        || this.nuevoRegistro.Fecha === undefined;
    }

    applyFilter(filterValue: string) &#123;
        this.dataSource.filter = filterValue.trim().toLowerCase();

        if (this.dataSource.paginator) &#123;
            this.dataSource.paginator.firstPage();
        }
    }
}
    </code></pre>

    <h2>Conclusi√≥n</h2>
    <p>En este post continuamos construyendo GLTrack, una aplicaci√≥n para registro de mediciones de glucosa en la sangre
        para
        pacientes de diabetes.</p>
    <p>Para construir el componente de registro dise√±amos un modelo de datos y creamos un formulario de captura
        utilizando
        Template-Driven forms de Angular y data-binding con la directiva ngModel.</p>
    <p>Tambi√©n creamos un servicio y lo implementamos con Dependency Injection. Por √∫ltimo, creamos una tabla con
        filtros,
        sorting y paginaci√≥n utilizando el componente MatTable de Angular Material.</p>
    <p>En el siguiente post, continuaremos construyendo un Dashboard como p√°gina de inicio de la aplicaci√≥n, donde
        mostraremos
        datos relevantes para el usuario acerca de sus mediciones de glucosa implementando valores de entrada y salida
        para
        interactuar entre componentes.</p>

    <p>El c√≥digo fuente completo de la aplicaci√≥n de ejemplo puedes encontrarlo en GitHub, en <a href="https://github.com/RCKSTR1/GLTrack2" target="_blank">https://github.com/RCKSTR1/GLTrack2</a>
        o si prefieres, puedes clonar el repositorio
        directo en https://github.com/RCKSTR1/GLTrack2.git</p>
    <p>Si tuviste alg√∫n problema o duda al seguir los pasos, o si tienes alguna pregunta acerca de este post, cont√°ctame
        en Twitter, Facebook o LinkedIn.</p>

    <p>
        <strong>Es cu√°nto.</strong>
    </p>

    <h2>Fuentes</h2>
    <ul>
        <li>Documentaci√≥n de Angular. "Template-driven forms". <a href="https://angular.io/guide/forms" target="_blank">https://angular.io/guide/forms</a></li>
        <li>Documentaci√≥n de Angular. "Introducci√≥n a los servicios y dependency injection". <a href="https://angular.io/guide/architecture-services" target="_blank">https://angular.io/guide/architecture-services</a></li>
        <li>Documentaci√≥n de Angular Material, "Form field". <a href="https://material.angular.io/components/form-field/overview" target="_blank">https://material.angular.io/components/form-field/overview</a></li>
        <li>Documentaci√≥n de Angular Material, "Input". <a href="https://material.angular.io/components/input/overview" target="_blank">https://material.angular.io/components/input/overview</a></li>
        <li>Documentaci√≥n de Angular Material, "Select". <a href="https://material.angular.io/components/select/overview" target="_blank">https://material.angular.io/components/select/overview</a></li>
        <li>Documentaci√≥n de Angular Material, "Table". <a href="https://material.angular.io/components/table/overview" target="_blank">https://material.angular.io/components/table/overview</a></li>
    </ul>
</div>
:ET